操作系统：alma linux 

htop不在baseOS/AppStream里，需要EPEL

安装epel仓库
```
dnf install -y epel-release
```

验证,安装成功会有对应输出
```
dnf repolist | grep epel
```

安装htop

```
dnf install -y htop
```

使用htop
```
htop
```
键入命令后会显示一个如下图的动态面板，相比top，它显示更直观，支持彩色显示、交互操作、滚动查看和树状进程。
![[Pasted image 20260121161412.png]]


**htop面板信息介绍**

htop面板可以划分为三个部分：

**A、顶部信息栏**

**左侧资源使用条**

0 / 1
- 数字0和1代表我的CPU核心，是一个双核CPU。
- 颜色含义：
	- 蓝色代表低优先级进程占用的CPU
	- 绿色代表普通用户进程
	- 红色代表系统内核进程
	- 青色代表虚拟化占用

MEM 296M/3.54G
- 297M是当前已使用的物理内存
- 3.54G系统总共可用的物理内存
- 颜色含义：绿色表示已用内存，蓝色代表缓冲(Buffers)，橙色表示缓存(Cache)
- Swp [ 0K / 3.91G ] ：
- 交换分区(Swap)的使用情况。交换分区是硬盘上模拟内存的空间。
- 图中显示0K，代表目前内存充足，没有数据被挤到硬盘交换区，这是健康的表现。


**右侧系统状态概览**

Tasks27 系统当前总共27个进程
11 thr 包含11个线程
147 kthr 内核线程数
0 running 当前正在运行的进程数为0
Load average：  系统平均负载（过去的1、5、15分钟），数字越小代表系统越闲。由于我是双核CPU，只要数值低于2.0，系统运行就是流畅的。
uptime 系统运行时间


**B、中间进程列表**

最上面的Main和I/O。


**Main**

Main代表默认的主界面，提供了进程的综合资源占用情况，用于快速查看哪些进程最消耗处理器资源或内存。

PID 进程标识符，它是系统分配给每个运行进程的唯一数字，用于识别和管理特定进程

USER  运行该进程的用户名

PRI 进程的调度优先级，该数值由内核决定，数值越小，优先级越高，通常为0-39

NI nice值，范围-20到19，可以理解成“谦让值”，负值表示高优先级，正值低优先级，即更谦让，把CPU资源让给其他谦让值更低的进程

VIRT 进程使用的虚拟内存总量

RES 进程当前占用的实际物理内存大小（RAM），这是衡量一个进程真实内存消耗的最准确的指标

SHR，进程使用的共享内存大小

CPU% ，进程占用的CPU资源百分比，在多核系统里，该值可能超过100%

MEM%，进程占用的物理内存（RES）占系统总物理内存的百分比

S(status)：进程当前状态。
- R，正在运行
- S，可中断睡眠，通常在等待某个事件
- D，不可中断睡眠，通常在等待I/O（Disk）
- Z，僵尸进程(Zombie)，已结束但未被父进程回收
- T，已停止或正在被追踪

TIME+，该进程自启动以来占用的CPU时间总计，精度通常达到百分之一秒

Command，启动该进程的完整命令行，包括其参数

**I/O**

I/O是副界面，代表输入输出模式，此模式专门监控进程对磁盘的读写活动。
此界面的关键指标：
- IO，I/O调度优先级，通常显示为B4或B3，数值越小优先级越高。
- DISK R/W，该进程当前的实时磁盘读写总速率(字节/秒)。
- DISK_READ，该进程当前的实时磁盘读取速率。
- DISK_WRITE，该进程当前的实时磁盘写入速率。
- SWPD%,该进程使用的交换分区（虚拟内存）占比。
- IOD% ，I/O等待耗时占比。反映了进程因为等待I/O完成而被迫停顿的时间比例。
- Command，启动该进程的完整命令路径。

关键指标解析：
- IO详解：在Linux中，I/O优先级通常由ionice控制。
	- B(Best-effort)：最常见的类型，范围一-7，数字越小，获取磁盘带宽的优先级越高。图中B4数默认值。
	- R(Real-time)：实时优先级，最高级别。
	- I(Idle)：仅在系统没有其他进程需要磁盘时才进行O/O。
- DISK READ / WRITE(实时速率)：这些数值是动态变化的。如果你发现某个进程的DISK WRITE忽然飙升，通常意味它正在保存大型文件或进行数据库写入操作。
- IOD%(排队压力)：这是一个很重要的性能指标。如果这个的百分比很高，说明磁盘已经成为了该进程的性能瓶颈。即使CPU很闲，进程也会因为磁盘转不动而卡住。

一般可以点击表头的DISK READ 或 DISK WRITE，快速找出哪些进程正在疯狂吃你的磁盘带宽。

用途：诊断系统卡顿是否由个别进程频繁读写磁盘(I/O瓶颈)导致。

这两个界面按tab键就可以自由切换。

如果界面显示内容不全，可以使用方向键。


**C、底部操作菜单**

htop底部有快捷键提示

F1 使用帮助
F2 设置面板（排序方式、列显示）
F3 搜索进程
F4 过滤进程
F5 树状方式显示进程（查看进程父子关系）
F6 排序列（CPU、MEM、TIME、PID等）
F7/F8 调整选中进程优先级（nice值）
F9 杀进程（发送信号）
F10 退出


**htop使用技巧**

1、按CPU/内存排序

F6 -> 选择 %CPU 或 %MEM

快速`找出最耗资源的进程`，适合性能诊断。


2、树状模式

F5

查看进程的父子关系，方便找出守护进程和子进程。`诊断服务卡顿时，通过查看子进程关系，确认是否有僵尸进程。`

3、过滤或搜索

F3 / F4

`快速定位某个服务的进程`，例如Nginx。

4、调整进程优先级

F7 / F8

`增加或降低nice值`，用于临时调度优化，特别是在高负载服务器上。

5、杀死进程

F9 -> 选择信号(默认 SIGTERM)

用于`手动终止异常进程`，比`kill -9 PID`更安全。

6、自定义界面

F2

这个我没用过。


**持续监控**

htop每10秒刷新一次

```
htop -d 10
```

