---
title: 虚拟主机
date: 2026-01-28 12:00:00 +0800
categories: [web服务器,nginx]
tags: [Virtual Hosts ]
---
**一、虚拟主机介绍**

虚拟主机就是把一台物理服务器划分为多个虚拟的服务器，每一台虚拟的服务器都可以有独立的域名和独立的目录，都可以独立发布一个网站。

**实验案例：同时发布两个网站**
- web1(192.168.88.128)根目录：/usr/local/nginx/html/web1
- web2(192.168.88.132)根目录：/usr/local/nginx/html/web2


**二、基于IP的虚拟主机**

应用场景：IP充足的环境，每个网站需要一个IP地址

```
#==============================
# web1 虚拟主机
#==============================
server {
    # 监听 192.168.88.128 的 80 端口
    listen 192.168.88.128:80;

    # server_name 在基于 IP 的虚拟主机中主要用于标识
    server_name web1;

    # 网站根目录
    root html/web1;

    # 默认首页文件
    index index.html index.htm;
	
	# try_files的作用在下面注释有说明，在这里仅补充，可以不加
    location / {
	    # 先找真实文件/xxx，再找目录/xxx/，都没有返回404，避免目录穿越、错误重定向和index混乱
        try_files $uri $uri/ =404;
    }

    # 访问日志，独立的日志方便区分流量来源，方便排错
    access_log logs/web1_access.log;
    error_log  logs/web1_error.log;
}

#==============================
# web2 虚拟主机
#==============================
server {
    # 监听 192.168.88.132 的 80 端口
    listen 192.168.88.132:80;

    server_name web2;

    root html/web2;
    index index.html index.htm;

    location / {
        try_files $uri $uri/ =404;
    }

    access_log logs/web2_access.log;
    error_log  logs/web2_error.log;
}

```

基于IP的虚拟主机特点：
- 不同IP对应不同网站
- 访问方便，用户直接使用默认端口即可访问
- 服务器需要有多个IP地址
- 维护方便，基于独立IP的站点，便于监控和维护

**三、基于端口的虚拟主机**

应用场景：IP不足的环境
- 优点：多个网站发布使用该配置方法只需要一个IP，节约IP地址
- 缺点：端口你是无法告诉公网用户，无法适用于公网的客户，适合内部用户

```
#====================================
# web1
#====================================
server {
    # 监听 8080 端口
    # 表示：凡是访问 192.168.88.128:8080 的请求
    # 都会进入这个 server 块
    listen 8080;

    # server_name 在端口虚拟主机中主要用于标识和可读性，可以不加
    server_name web1;

    # web1 网站根目录
    root /html/web1;

    # 默认首页
    index index.html index.htm;

    location / {
        # 尝试访问真实文件
        # 如果文件和目录都不存在，返回 404
        try_files $uri $uri/ =404;
    }

    # web1 独立日志
    access_log logs/web1_8080_access.log;
    error_log  logs/web1_8080_error.log;
}

#====================================
# web2
#====================================
server {
    # 监听 9090 端口
    # 访问 192.168.88.132:9090 时命中
    listen 9090;

    server_name web2;

    root /html/web2;
    index index.html index.htm;

    location / {
        try_files $uri $uri/ =404;
    }

    access_log logs/web2_9090_access.log;
    error_log  logs/web2_9090_error.log;
}

```

基于端口的虚拟主机特点：
- 不同端口对应不同网站
- 访问需要加端口
- 节约IP地址
- 适合私网运行

**四、基于域名的虚拟主机**

应用场景：一个网站需要一个域名，目前公网发布网站的首选

```
#====================================
# web1
#====================================
server {
    # 监听 80 端口
    listen 80;

    # 在基于域名的虚拟主机里的核心匹配条件：Host 请求头，一定要配置
    server_name www.web1.com;

    # web1 网站根目录
    root /html/web1;

    # 默认首页
    index index.html index.htm;

    location / {
        # 防止访问不存在的资源
        try_files $uri $uri/ =404;
    }

    # web1 独立日志
    access_log logs/web1_access.log;
    error_log  logs/web1_error.log;
}

#====================================
# web2
#====================================
server {
    listen 80;

    server_name www.web2.com;

    root /html/web2;
    index index.html index.htm;

    location / {
        try_files $uri $uri/ =404;
    }

    access_log logs/web2_access.log;
    error_log  logs/web2_error.log;
}

```

基于域名的虚拟主机特点：
- 不同域名对应不同的网站
- 需要多个域名，可以是二级或三级域名
- 每个站点使用默认端口，方便用户访问
- 适合公网环境

**server_name写法**

```
server_name www.web1.com web1.com;
```

```
server_name *.web1.com;
```

甚至支持正则表达式写法，不过没必要

