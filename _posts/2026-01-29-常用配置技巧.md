**1、一个站点配置多个域名**

```
server {
    listen 80;
    server_name site.cn b.site.cn;

    root /home/project/pb;        # 网站根目录
    index index.html;             # 默认首页

}

```


**2、一个服务配置多个站点**

```
# 默认站点
server {
    listen 80 default_server;
    server_name _;
    return 404;
}

# 站点 A
server {
    listen 80;
    server_name a.site.cn;

    root /home/project/pa;
    index index.html;
}

# 站点 B
server {
    listen 80;
    server_name site.cn b.site.cn;

    root /home/project/pb;
    index index.html;
}

# 站点 C
server {
    listen 80;
    server_name c.site.cn;

    root /home/project/pc;
    index index.html;
}

```


**3、虚拟主机和登录账号密码认证**

前面已经有涉及，这里略过。


**4、nginx开启列目录**

适用于想让Nginx做下载服务器时，需要开启列目录
```
server {
    location /download/ {
        # 如果需要，可以使用allow和deny设置IP白名单
        autoindex on;

        autoindex_exact_size off;
        autoindex_localtime on;
        charset utf-8;
    }
}
```

autoindex_exact_size： 为on(默认)时显示文件的确切大小，单位是byte；改为off显示文件大概大小，单位KB或MB或GB

autoindex_localtime： 为off(默认)时显示的文件时间为GMT时间；改为on后，显示的文件时间为服务器时间

默认访问列出的txt等文件时会在浏览器显示文件内容，如果想让浏览器直接下载，参考下面的配置：
```
location /download/ {
    autoindex on;
    autoindex_exact_size off;
    autoindex_localtime on;
    charset utf-8;

    # 对特定文件类型强制下载
    location ~* \.(txt|pdf|zip|exe)$ {
        add_header Content-Disposition "attachment";
    }
}
```

如果希望什么文件都可以点击下载
```
location /files/ {
    autoindex on;
    autoindex_exact_size off;
    autoindex_localtime on;
    charset utf-8;

    add_header Content-Disposition "attachment";
}
```


**5、配置默认站点**
```
server {
	# 以前的nginx使用default
    listen 80 default_server;
    server_name _;
}

```

当一个Nginx服务创建了多个虚拟主机时，会默认从上到下查找，如果匹配不到虚拟主机会返回第一个虚拟主机的内容，可以将这个站点的虚拟主机放在配置文件中第一个虚拟主机的位置，或者配置listen default。

**6、不允许通过ip访问**
```
server {
    listen 80 default_server;
    server_name _;
    return 404;
}
```

有可能某些未备案域名或者不希望的域名将服务器地址转向了你的服务器，这时候就会对你的站点造成一定影响，需要禁止IP或未配置的域名访问，可以利用上面说的default规则，将默认流量都转到404。

上面的方法比较粗暴，也可以设置所有未配置的地址访问时直接301重定向到你的网站，也能给你的网站带来一定流量。

```
server {
    listen 80 default_server;
    server_name _;

    # 301 永久重定向到主站
    return 301 https://www.mysite.cn$request_uri;

    # 可选：关闭访问日志，减少无用日志
    access_log off;
    error_log /var/log/nginx/default_redirect_error.log;
}

```

**7、直接返回验证文件**
```
location = /XDFyle6tNA.txt {
    default_type text/plain;
    access_log off;
    log_not_found off;
    # 返回验证文件内容
    return 200 'd6296a84657eb275c05c31b10924f6ea';
}
```

很多时候微信等程序都需要我们放一个txt的文件到项目里以验证项目归属，我们可以直接通过上边这种方式修改nginx即可，无需真正的把文件给放到服务器上


**8、nginx配置upstream反向代理**

```
http {
    ...
    upstream web {
        server 192.168.1.176 weight=1;
        server 192.168.1.177 weight=1;
    }

    server {
        location /site/ { 
            proxy_pass http://web; 

            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

}
```

**9、404自动跳转到首页**

```
server {
    listen 80;
    server_name a.com;

    root /var/www/html;
    index index.html;

    # 404 统一交给首页
    error_page 404 /index.html;
}
```

网站出现404不是很友好