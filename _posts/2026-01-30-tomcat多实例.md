
tomcat是一个单进程多线程的软件，在比较早期，很多CPU是单核的时候这种模式很适合，但现在普遍都是多核的CPU了，如果还只是一个进程比较浪费CPU资源。

如果要提高资源的利用效率，可以考虑多开几个tomcat，也就是这里要用的tomcat多实例。

在之前的内容提过tomcat有三个端口8005 8009 8080，8005用来关闭tomcat端口，8080是访问端口，8009是ajp协议使用的端口(新版本默认被注释禁用，如果你用不到ajp协议也没必要开)。

如果想在一台机器上多开tomcat，首先需要确保端口不能冲突，否则开不了。



**tomcat多实例实现**

1、将之前部署好的tomcat复制一份
```
[root@192 tomcat1]# cd /opt
[root@192 opt]# ls
tomcat1
[root@192 opt]# cp -r tomcat1 tomcat2
[root@192 opt]# ls
tomcat1  tomcat2
```

2、修改刚刚部署完成的tomcat相关配置文件
```
vim tomcat2/conf/server.xml
```

必须修改以下端口：

|用途|默认|示例|
|---|---|---|
|HTTP|8080|8080|
|Shutdown|8005|8005|
|AJP|8009|8009|

第二个实例修改端口（其他实例操作同理）：

|类型|端口|
|---|---|
|HTTP|8081|
|Shutdown|8006|
|AJP|8010|

改好以后启动tomcat
```
sh /opt/tomcat1/bin/startup.sh
sh /opt/tomcat2/bin/startup.sh

ss -tunlp | grep java
```


![](/assets/img/Pasted image 20260201203646.png)

打开浏览器访问测试
http://ip:8080 

![](/assets/img/Pasted image 20260201204856.png)


还有 http://192.168.88.128:8081
![](/assets/img/Pasted image 20260201204922.png)

注意，这里有一个容易被忽略的地方：如果是不同的用户使用的话，考虑安全方面的问题，记得修改tomcat的用户管理文件(tomcat-users.xml)
```
vim /opt/tomcat2/conf/tomcat-users.xml
```

全权限示例配置及说明（仅供参考，真实情况不建议给一个用户这么多权限，会出现很大风险）：
```
<tomcat-users>

    <!-- ================== 角色定义区 ================== -->

    <!--
        manager-gui
        作用：允许通过浏览器访问 /manager/html
        用途：在 Web 页面上部署 / 停止 / 重载应用
        风险：权限较高，不建议对公网开放
    -->
    <role rolename="manager-gui"/>

    <!--
        manager-script
        作用：允许通过 URL / API 方式管理 Tomcat
        用途：CI/CD 自动化部署（curl、Jenkins）
        风险：一旦泄露，可远程部署 war
    -->
    <role rolename="manager-script"/>

    <!--
        manager-jmx
        作用：允许通过 JMX 方式监控 Tomcat
        用途：JConsole、Prometheus、Java 监控
        一般生产较少直接用
    -->
    <role rolename="manager-jmx"/>

    <!--
        manager-status
        作用：访问 /manager/status
        用途：查看线程数、请求数、JVM 状态
        相对只读，风险较低
    -->
    <role rolename="manager-status"/>

    <!--
        admin-gui
        作用：允许访问 /host-manager/html
        用途：管理虚拟主机（Host）
        风险：可新增 Host，权限非常高
    -->
    <role rolename="admin-gui"/>

    <!--
        admin-script
        作用：通过脚本/API 管理虚拟主机
        用途：自动化 Host 管理
        风险：极高
    -->
    <role rolename="admin-script"/>


    <!-- ================== 用户定义区 ================== -->

    <!--
        用户名：tomcat
        密码：tomcat（危险，仅示例）
        拥有角色：
          - manager-gui
          - manager-script
          - manager-jmx
          - manager-status
          - admin-gui
          - admin-script

        等于：
         Tomcat 管理后台的“超级管理员”
         拿到这个账号 = 完全控制 Tomcat
    -->
    <user
        username="tomcat"
        password="tomcat"
        roles="manager-gui,manager-script,manager-jmx,manager-status,admin-gui,admin-script"/>

</tomcat-users>

```


推荐的配置

只给浏览器管理权限
```
<role rolename="manager-gui"/>

<user username="app_admin"
      password="密码"
      roles="manager-gui"/>
```

CI / CD 专用（无GUI）
```
<role rolename="manager-script"/>

<user username="deploy_bot"
      password="密码"
      roles="manager-script"/>
```

