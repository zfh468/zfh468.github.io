
**数据安全介绍**

核心目标：防止重要数据丢失，在发生事故后可以恢复业务。

备份的本质：不是为了存数据，而是在任何灾难情况下，都可以恢复业务运行。


常备份的数据位置：
- `/etc`
- `/var`
- `/home`

除了标准的系统重要文件，你安装的某些服务，也需要备份


============================================


**磁带备份**

磁带机`/dev/st0`

常见磁带命令

倒带
```
mt -f /dev/st0 rewid
```

擦除
```
mt -f /dev/st0 erase
```

出带
```
mt -f /dev/st0 offline
```

查看磁带内容
```
tar tvf /dev/st0 [位置]
```

备份数据到磁带
```
tar cvf /dev/st0 [位置]
```

继续写入数据
```
tar rvf /dev/st0 [位置]
```

把磁带中的数据恢复到硬盘
```
# 不加位置全量恢复，加为定向精准恢复
tar xvf /dev/st0 [位置]
```



===========================================


**硬盘备份**


1. 完全备份 (Full Backup)
定义： 备份选定目录或整个硬盘的所有数据，不考虑数据是否被修改过。

恢复： 最快。只需找到最后一份完全备份文件即可。

缺点： 极度占用空间，备份过程最耗时。

场景： 通常作为备份周期的起点（如每周日进行一次）。




2. 增量备份 (Incremental Backup)
对应你提到的“累计增量备份”逻辑，但在标准术语中，它指代“自上一次备份（无论是全备还是增备）以来的变化”。

逻辑：

周一：完全备份

周二：备份“周二”相对于“周一”增加的数据

周三：备份“周三”相对于“周二”增加的数据

恢复： 完全备份 + 周二增量 + 周三增量 + ...

优点： 备份速度极快，占用空间最小。

缺点： 恢复逻辑最复杂。如果中间任何一天的增量包损坏，后续数据将无法完整恢复。



3. 差异备份 (Differential Backup)
逻辑： 始终备份自上一次完全备份以来发生的所有变化。

逻辑示例：

周一：完全备份

周二：备份“周二”相对于“周一”的数据

周三：备份“周二+周三”相对于“周一”的数据

恢复： 完全备份 + 最后一次差异备份。

优点： 空间与速度的折中方案。恢复比增量备份简单，安全性更高（只需两个包）。

缺点： 随着时间推移，差异包会越来越大，备份速度变慢



=====================================================================



**tar命令备份**

tar完全备份
```
# -c: 创建, -v: 显示过程, -p: 保留权限, -z: gzip压缩, -f: 指定文件名
tar -cvpzf backup_full.tar.gz /data
```


================================================

**dump命令备份数据**


```
yum -y install dump
yum -y install xfsdump
```


dump实现增量备份（ext）

支持0-9级别
0=完全备份 1~9=增量备份

dump会记录备份历史在：/etc/dumpdates

```
# -f指定输出文件 -u更新 /etc/dumpdates -0 0级完整备份
dump -0u -f /root/boot.dump /boot
dump -1u -f /root/boot.level1 /boot
```

**xfsdump备份（xfs）**

```
xfsdump -f /root/dump_sda1 /dev/sda1
```
对/boot/文件夹进行备份



```
xfsrestore -f /root/dump_sda1 /root/sda1-test
```
把/root/dump_sda1恢复到/root/sda1-test

  
```
xfsdump -1j -f /root/boot-z1 /dev/sda1
```
进行增量备份



=================================

dd常用于数据备份，不过也可以被用来进行数据窃取和制作取证镜像

语法：
```
dd if=输入文件 of=输出文件 [选项]
```

参数选项：

| 参数        | 含义                | 说明           | 常见示例                  |
| --------- | ----------------- | ------------ | --------------------- |
| `if=`     | input file        | 指定输入源        | `if=/dev/sda1`        |
| `of=`     | output file       | 指定输出目标       | `of=/root/backup.img` |
| `bs=`     | block size        | 每次读写的块大小     | `bs=4M`               |
| `count=`  | 块数量               | 复制多少个块       | `count=100`           |
| `status=` | 显示状态              | 显示进度信息       | `status=progress`     |


注意！！！写错输出文件会导致磁盘被覆盖！！！！


dd if=/dev/sda1 of=/root/boot.bak
备份分区


dd if=/root/boot.bak of=/dev/sda1
恢复到分区


dd if=/dev/sda1 of=/dev/sdb
整盘备份


dd if=/dev/cdrom of=/tmp/cd.iso
把光盘中的内容制作成iso文件（光盘镜像）


mkdir /mnt/cd
建立一个挂载点


mount -o loop /tmp/cd.iso /mnt/cd
把光盘镜像挂载到/mnt/cd


dd命令非常强大，但是危险，不小心可能毁盘，使用需要谨慎

===========================================


**rsync远程备份**

本地同步：
`-a`保留文件原样复制
```
# 把本机的/erc/passwd文件同步到本机的/tmp/1.txt
rsync -av /etc/passwd /tmp/1.txt
```

远程同步：
```
# 把本机/etc/passwd文件通过ssh发送到远程服务器192.168.1.10的/tmp/1.txt
rsync -av /etc/passwd 192.168.1.10:/tmp/1.txt
```
