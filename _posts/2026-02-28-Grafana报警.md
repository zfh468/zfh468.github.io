---
title: Grafana报警
date: 2026-02-28 08:00:00 +0800
categories: [prometheus + grafana]
tags: [alert]
---
设置步骤：

1. 配置联系点(contact points)，定义报警信息发送到哪里，比如邮箱、钉钉
    
2. 创建告警规则(Alert Rules)，定义什么情况下会触发告警
    
3. 配置通知策略(Notification Policies)，定义告警应该发送给哪个联系点（路由规则）



我这里使用qq邮箱

获取QQ邮箱的SMTP授权码


配置Grafana，填入QQ邮箱的SMTP信息
```
vi /etc/grafana/grafana.ini
```


找到`[SMTP]`部分，按如下修改
```
[smtp]
enabled = true
host = smtp.qq.com:465
user = 你的QQ号@qq.com
# 此处填写刚才生成的16位授权码
password = your_auth_code_here
from_address = 你的QQ号@qq.com
from_name = Grafana_Alert
# QQ邮箱465端口必须开启 skip_verify
skip_verify = true

```


重启Grafana
```
systemctl restart grafana-server
```



### 一、配置联系点

点击左侧菜单栏的Alerting

点击Contact points

Create contact point，创建联系点

![](/assets/img/Pasted image 20260228103317.png)

填好信息后，点击测试，Grafana会发送测试邮件

![](/assets/img/Pasted image 20260228103442.png)
如图收到代表成功，保存联系点



### 二、告警规则设置


查询mysql_up结果为1说明mariadb服务正在运行，0代表停止

这就是监控的阈值


Alerting > Alert rules > New alert rule

设置规则名、Prometheus数据源、监控指标、目标筛选、阈值、选择联系点


然后保存
![](/assets/img/Pasted image 20260228104928.png)



### 三、通知策略配置


之前已经配置好默认的联系点，这个新创建的告警规则会自动匹配到默认的通知策略，所以mariadb宕机以后就可以收到告警邮件了

停止mariadb服务，等待告警邮件

收到邮件代表成功了

  
通知策略的工作原理：通过匹配告警规则的标签，来决定把这条告警发送给哪个联系点



**测试**

在node1停止mariadb服务
```
systemctl stop mariadb
```

收到报警邮件

![](/assets/img/Pasted image 20260228105258.png)

