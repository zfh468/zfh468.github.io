---
title: 监控业务主机MariaDB服务
date: 2026-02-28 02:00:00 +0800
categories: [prometheus + grafana]
tags: [mysql_exporter]
---

**案例**：通过Prometheus监控MariaDB业务

监控mysql需要mysql监控插件(mariadb和mysql通用)，而且目标系统也要有mysql服务。

先安装mysql，进行授权，让插件可以获取需要的信息，再设置相关插件，修改Prometheus配置文件


业务主机node1 192.168.88.137


### 实现步骤

a、node1部署mariadb
```
dnf install -y mariadb-server mariadb
systemctl enable --now mariadb
```

b、登录MariaDB交互
```
mysql -u root -p  # mariadb默认空密码，直接回车即可
```

创建监控用户：
```
# 1、创建hello用户，只能本地登录，密码123456
grant select,replication client,process on *.* to 'hello'@'localhost' identified by '123456';

# 2、刷新权限
flush privileges;

# 3、退出
exit;
```


c、部署mysql监控插件
```
# 1、下载软件包
wget https://github.com/prometheus/mysqld_exporter/releases/download/v0.18.0/mysqld_exporter-0.18.0.linux-amd64.tar.gz

# 安装
tar xf mysqld_exporter-0.18.0.linux-amd64.tar.gz -C /usr/local/
```


设置配置文件
```
vim /usr/local/mysqld_exporter-0.18.0.linux-amd64/.my.cnf
```

内容为：
```
[client]
user=hello
password=123456
```


启动mysql监控插件
```
nohup /usr/local/mysqld_exporter-0.18.0.linux-amd64/mysqld_exporter --config.my-cnf=/usr/local/mysqld_exporter-0.18.0.linux-amd64/.my.cnf &

# 检查启动
lsof -i :9104
```

放行9104
```
sudo firewall-cmd --permanent --add-port=9104/tcp
sudo firewall-cmd --reload
```


d、在Prometheus（192.168.88.137）的主配置文件添加监控
```
vi prometheus.yml
```

```
  - job_name: "mariadb"
    static_configs:
      - targets:  ["192.168.88.138:9104"]
```


重启Prometheus服务
```
pkill prometheus && ./prometheus --config.file=prometheus.yml &
```



e、验证

![](/assets/img/Pasted image 20260228082421.png)



